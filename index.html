<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i ch·ªã Nguy√™n</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* --- C√ÄI ƒê·∫∂T C∆† B·∫¢N --- */
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; background: #fff0f3; overflow: hidden; touch-action: manipulation; }
        .artistic-font { font-family: 'HLT Aphroditeslimpro', 'Dancing Script', cursive; color: #d63384; }
        
        /* M√†n h√¨nh */
        .screen {
            display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center; transition: opacity 0.5s; padding: 15px; box-sizing: border-box;
        }
        .active { display: flex; z-index: 10; }

        /* N√∫t b·∫•m */
        .btn-style {
            margin-top: 20px; padding: 12px 30px; border-radius: 30px; border: none;
            background: linear-gradient(45deg, #ff4d6d, #ff8fa3); color: white;
            font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 15px rgba(255,77,109,0.4);
            z-index: 100; transition: transform 0.2s;
        }
        .btn-style:hover { transform: scale(1.05); }
        .btn-style:active { transform: scale(0.95); } 

        /* N√öT ƒêI·ªÄU KHI·ªÇN NH·∫†C (M·ªöI) */
        .music-control {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #ff4d6d;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* --- TRANG 1: THI·ªÜP --- */
        .card-envelope {
            background: #fffdf9; padding: 30px; border-radius: 15px; border: 2px solid #ffe0e9;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; width: 100%; position: relative;
            box-sizing: border-box;
        }
        .card-envelope::before { content: 'üå∏'; position: absolute; top: 10px; left: 10px; font-size: 20px; }
        .card-envelope::after { content: 'üå∏'; position: absolute; bottom: 10px; right: 10px; font-size: 20px; }

        /* --- TRANG 2: KHU V·ª∞C B√ÄI --- */
        #game-area {
            position: relative; width: 100%; height: 65vh; 
            display: flex; flex-wrap: wrap; justify-content: center; align-content: center; gap: 10px;
            overflow: hidden; 
        }
        
        .card-item {
            width: 70px; height: 100px;
            background: linear-gradient(135deg, #e63946, #d62828);
            border: 2px solid #ffd700; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            font-size: 30px; color: #ffd700; cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            user-select: none; -webkit-tap-highlight-color: transparent;
            transition: transform 0.2s; 
            z-index: 5;
        }

        .card-item.locked { filter: grayscale(0.5); cursor: not-allowed; }
        @media (hover: hover) {
            .card-item:hover { z-index: 1000; transform: scale(1.2); border-color: white; }
        }

        /* --- TRANG 3: C√ÄO (ƒê√É T·ªêI ∆ØU C·∫¢M ·ª®NG) --- */
        #scratch-wrapper { 
            position: relative; width: 300px; height: 150px; 
            margin: 20px auto; border-radius: 10px; overflow: hidden; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
            max-width: 90vw; 
            touch-action: none; 
            -webkit-user-select: none;
            user-select: none;
        }
        .prize-bg { position: absolute; width: 100%; height: 100%; background: #ff9a9e; display: flex; justify-content: center; align-items: center; z-index: 0; }
        .prize-content { color: white; font-weight: bold; font-size: 1.4rem; padding: 10px; word-break: break-word; }
        
        canvas { 
            position: relative; z-index: 1; 
            cursor: crosshair; 
            touch-action: none; 
        }

        /* --- TRANG 4: K·∫æT QU·∫¢ --- */
        .final-list { list-style: none; padding: 0; margin: 20px 0; width: 100%; }
        .final-list li { 
            background: white; padding: 12px; margin: 8px auto; 
            width: 90%; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: #d63384; font-weight: bold; font-size: 1.1rem;
            transition: all 0.3s;
        }

        .special-prize {
            background: linear-gradient(135deg, #fff8db, #ffd700) !important;
            border: 2px solid #b8860b !important;
            color: #d35400 !important;
            font-size: 1.3rem !important;
            text-shadow: 0px 0px 2px rgba(255,255,255,0.8);
            animation: goldGlow 1.5s infinite alternate;
        }

        @keyframes goldGlow {
            from { box-shadow: 0 0 5px #ffd700; transform: scale(1); }
            to { box-shadow: 0 0 20px #ffd700, 0 0 10px #ff8c00; transform: scale(1.03); }
        }

        /* --- RESPONSIVE MOBILE --- */
        @media (max-width: 600px) {
            .artistic-font { font-size: 1.5rem !important; }
            h1.artistic-font { font-size: 2.2rem !important; }
            h2.artistic-font { font-size: 1.8rem !important; }
            .card-envelope { padding: 20px; }
            .greeting-body { font-size: 1.2rem !important; }
            .card-item { width: 50px; height: 75px; font-size: 20px; border-width: 1.5px; }
            #game-area { height: 60vh; gap: 8px; }
            .btn-style { font-size: 1rem; padding: 10px 25px; }
        }
    </style>
</head>
<body>
    
    <audio id="bgMusic" loop>
        <source src="tba.mp3" type="audio/mpeg">
    </audio>
    <div id="musicControl" class="music-control" onclick="toggleMusic()">üîá</div>

    <div id="step1" class="screen active">
        <div class="card-envelope">
            <h1 class="artistic-font">Dear Nguy√™n s√†n,</h1>
            <p class="artistic-font greeting-body" style="font-size: 1.5rem; line-height: 1.6;">
                NƒÉm 2025 ch·ªã v·∫•t v·∫£ r·ªìi, ch√∫ng ta ƒë·ªÅu bi·∫øt ch·ªã iu ƒë√£ r·∫•t c·ªë g·∫Øng.<br>
                NƒÉm t·ªõi ch·∫Øc c≈©ng c√≥ v·∫•t v·∫£ üôÑ, nh∆∞ng r·ªìi s·∫Ω v∆∞·ª£t qua ƒë∆∞·ª£c thui.
            </p>
        </div>
        <button class="btn-style" onclick="startExperience()">Ti·∫øp theo ‚ûî</button>
    </div>

    <div id="step2" class="screen">
        <h2 id="pick-title" class="artistic-font" style="font-size: 2rem;">B·∫°n c√≥ 2 l·∫ßn ch·ªçn</h2>
        <div id="game-area"></div>
        <button id="btn-start-fly" class="btn-style" onclick="startPhysicsLoop()">B·∫ÆT ƒê·∫¶U</button>
        <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">(Nh·∫•n b·∫Øt ƒë·∫ßu ƒë·ªÉ b√†i bay l√™n)</p>
    </div>

    <div id="step3" class="screen">
        <h2 class="artistic-font">C√†o ƒë·ªÉ xem k·∫øt qu·∫£</h2>
        <div id="scratch-wrapper">
            <div class="prize-bg"><div class="prize-content" id="prize-result">???</div></div>
            <canvas id="scratchCanvas" width="300" height="150"></canvas>
        </div>
        <button id="btn-confirm" class="btn-style" style="display:none;" onclick="finishScratch()">NH·∫¨N QU√Ä</button>
    </div>

    <div id="step4" class="screen">
        <h1 class="artistic-font" style="font-size: 2.5rem;">Ch√∫c M·ª´ng NƒÉm M·ªõi 2026! üéá</h1>
        <p>Ch·ªã Nguy√™n ƒë√£ nh·∫≠n ƒë∆∞·ª£c:</p>
        <ul id="final-results" class="final-list"></ul>
        <p class="artistic-font" style="font-size: 1.3rem; margin-top: 20px;">Mong m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t s·∫Ω ƒë·∫øn v·ªõi ch·ªã.</p>
    </div>

    <script>
        // --- X·ª¨ L√ù NH·∫†C N·ªÄN ---
        const bgMusic = document.getElementById('bgMusic');
        const musicControl = document.getElementById('musicControl');
        let isMusicPlaying = false;

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicControl.innerText = "üîá";
                isMusicPlaying = false;
            } else {
                bgMusic.play().then(() => {
                    musicControl.innerText = "üîä";
                    isMusicPlaying = true;
                }).catch(e => console.log("Ch∆∞a th·ªÉ ph√°t nh·∫°c: ", e));
            }
        }

        // H√†m n√†y ƒë∆∞·ª£c g·ªçi khi b·∫•m n√∫t ·ªü trang ƒë·∫ßu ti√™n
        // ƒê·ªÉ "ƒë√°nh l·ª´a" tr√¨nh duy·ªát r·∫±ng ng∆∞·ªùi d√πng ƒë√£ t∆∞∆°ng t√°c, cho ph√©p ph√°t nh·∫°c
        function startExperience() {
            // Th·ª≠ ph√°t nh·∫°c
            bgMusic.play().then(() => {
                musicControl.innerText = "üîä";
                isMusicPlaying = true;
            }).catch(e => {
                console.log("Autoplay b·ªã ch·∫∑n, ng∆∞·ªùi d√πng c·∫ßn b·∫•m n√∫t loa th·ªß c√¥ng");
            });

            // Chuy·ªÉn trang
            goToGame();
        }

        // --- C·∫§U H√åNH ---
        const SPECIAL_PRIZE = "M·ªôt ƒë√≤i h·ªèi b·∫•t k·ª≥ trong kh·∫£ nƒÉng";
        const wishes = [
            "50.000ƒë", "10.000ƒë", "20.000ƒë", 
            "10.000ƒë", "10.000ƒë", "30.000ƒë",
            "100.000ƒë", "40.000ƒë", "20.000ƒë", 
            SPECIAL_PRIZE 
        ];
        
        let remainingPicks = 2;
        let collectedPrizes = [];
        let animationFrameId;
        let flyingObjects = []; 
        let cardWidth = 70;
        let cardHeight = 100;

        // --- ƒêI·ªÄU H∆Ø·ªöNG ---
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
                s.style.opacity = 0;
            });
            const screen = document.getElementById(id);
            screen.classList.add('active');
            setTimeout(() => screen.style.opacity = 1, 100);
        }

        function goToGame() {
            switchScreen('step2');
            initCardsGrid();
        }

        // --- LOGIC GAME ---
        function initCardsGrid() {
            const area = document.getElementById('game-area');
            if (area.children.length === 0) {
                for (let i = 0; i < 10; i++) {
                    let card = document.createElement('div');
                    card.className = 'card-item locked'; 
                    card.innerHTML = 'üßß';
                    card.id = `card-${i}`;
                    
                    const handleTap = (e) => { 
                        if(!card.classList.contains('locked')) e.preventDefault(); 
                        pickCard(card); 
                    };
                    card.addEventListener('mousedown', handleTap);
                    card.addEventListener('touchstart', handleTap);
                    
                    area.appendChild(card);
                }
            } else {
                resetToGrid();
            }
        }

        function startPhysicsLoop() {
            if (remainingPicks === 0) return;
            document.getElementById('btn-start-fly').style.display = 'none';
            
            const area = document.getElementById('game-area');
            const cards = Array.from(document.querySelectorAll('.card-item'));
            flyingObjects = [];

            if (cards.length > 0) {
                cardWidth = cards[0].offsetWidth;
                cardHeight = cards[0].offsetHeight;
            }

            cards.forEach(card => {
                if (card.style.display === 'none') return; 

                const rect = card.getBoundingClientRect();
                const areaRect = area.getBoundingClientRect();
                const startX = rect.left - areaRect.left;
                const startY = rect.top - areaRect.top;

                card.style.position = 'absolute';
                card.style.left = startX + 'px';
                card.style.top = startY + 'px';
                card.style.margin = '0'; 
                card.classList.remove('locked');

                let speedFactor = window.innerWidth < 600 ? 3 : 5;
                let dx = (Math.random() - 0.5) * speedFactor; 
                let dy = (Math.random() - 0.5) * speedFactor; 
                
                if (Math.abs(dx) < 1) dx = dx > 0 ? 1 : -1; 

                flyingObjects.push({ el: card, x: startX, y: startY, dx: dx, dy: dy });
            });

            animate();
        }

        function animate() {
            const area = document.getElementById('game-area');
            const maxX = area.clientWidth - cardWidth;
            const maxY = area.clientHeight - cardHeight;

            flyingObjects.forEach(obj => {
                obj.x += obj.dx;
                obj.y += obj.dy;
                
                if (obj.x <= 0 || obj.x >= maxX) obj.dx *= -1;
                if (obj.y <= 0 || obj.y >= maxY) obj.dy *= -1;
                
                obj.x = Math.max(0, Math.min(obj.x, maxX));
                obj.y = Math.max(0, Math.min(obj.y, maxY));
                
                obj.el.style.left = obj.x + 'px';
                obj.el.style.top = obj.y + 'px';
            });
            animationFrameId = requestAnimationFrame(animate);
        }

        function pickCard(cardElement) {
            if (cardElement.classList.contains('locked')) return;
            cancelAnimationFrame(animationFrameId);

            let prize;
            if (collectedPrizes.length === 0) {
                prize = wishes[Math.floor(Math.random() * wishes.length)];
            } else {
                const firstPrize = collectedPrizes[0];
                if (firstPrize === SPECIAL_PRIZE) {
                    prize = wishes[Math.floor(Math.random() * wishes.length)];
                } else {
                    prize = SPECIAL_PRIZE; 
                }
            }
            
            document.getElementById('prize-result').innerText = prize;
            window.currentCard = cardElement;
            window.currentPrize = prize;

            switchScreen('step3');
            setupScratch();
        }

        function resetToGrid() {
            const cards = document.querySelectorAll('.card-item');
            cards.forEach(card => {
                card.style.position = '';
                card.style.left = '';
                card.style.top = '';
                card.style.margin = '';
                card.classList.add('locked');
            });
        }

        // --- C√ÄO TH·∫∫ (C∆† CH·∫æ M·ªöI M∆Ø·ª¢T M√Ä) ---
        function setupScratch() {
            const canvas = document.getElementById('scratchCanvas');
            const wrapper = document.getElementById('scratch-wrapper');
            const ctx = canvas.getContext('2d');
            const btn = document.getElementById('btn-confirm');
            btn.style.display = 'none'; 

            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;

            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#C0C0C0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#666';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = "center";
            ctx.fillText("C√†o l·ªõp b·∫°c ƒëi...", canvas.width/2, canvas.height/2 + 5);

            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = 40; 
            ctx.globalCompositeOperation = 'destination-out';

            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            };

            const startDraw = (e) => {
                e.preventDefault(); 
                isDrawing = true;
                const pos = getPos(e);
                lastX = pos.x;
                lastY = pos.y;
            };

            const moveDraw = (e) => {
                if (!isDrawing) return;
                e.preventDefault(); 
                
                const pos = getPos(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();

                lastX = pos.x;
                lastY = pos.y;
            };

            const endDraw = () => {
                isDrawing = false;
                btn.style.display = 'block';
            };

            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('touchstart', startDraw, { passive: false });
            canvas.addEventListener('mousemove', moveDraw);
            canvas.addEventListener('touchmove', moveDraw, { passive: false });
            canvas.addEventListener('mouseup', endDraw);
            canvas.addEventListener('touchend', endDraw);
        }

        function finishScratch() {
            collectedPrizes.push(window.currentPrize);
            remainingPicks--;

            window.currentCard.style.display = 'none'; 

            if (remainingPicks > 0) {
                document.getElementById('pick-title').innerText = `B·∫°n c√≤n ${remainingPicks} l·∫ßn ch·ªçn`;
                document.getElementById('btn-start-fly').style.display = 'inline-block';
                document.getElementById('btn-start-fly').innerText = "Ti·∫øp t·ª•c x√°o b√†i";
                switchScreen('step2');
                resetToGrid(); 
            } else {
                showFinalResult();
            }
        }

        function showFinalResult() {
            switchScreen('step4');
            const list = document.getElementById('final-results');
            list.innerHTML = '';
            
            collectedPrizes.forEach(p => {
                let li = document.createElement('li');
                if (p === SPECIAL_PRIZE) {
                    li.innerHTML = "üëë " + p + " üëë";
                    li.classList.add('special-prize'); 
                } else {
                    li.innerText = "‚ú® " + p;
                }
                list.appendChild(li);
            });
            startFireworks();
        }

        function startFireworks() {
            var duration = 15 * 1000;
            var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }
    </script>
</body>
</html>